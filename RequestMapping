package com.ssafy.day06.c_annotation;

@Retention(RetentoinPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface RequestMapping {
	String value();

}

// 정보만 준 것!!
public class BoardController {

    // 메소드와 묶여있다
	@RequestMapping(value="/board/list")
	public void list() {
		sysout("list 호출");
	}
	
	@RequestMapping(value="/board/WriteForm")
	public void WriteForm() {
		sysout("WriteForm 호출");
	}
	
	@RequestMapping(value="/board/delete")
	public void delete() {
		sysout("delete 호출");
	}	
}


public class Executor {

	// 메소드 수행 어디 클래스인지 같이 보관해야함 
	// private Map<String, ?> mapping = new HashMap<>();
	private Map<String, CtrlAndMethod> mapping = new HashMap<>();

	// 싱글톤 방식으로
	private Executor() throws Exception {
		Class<?> clz = BoardController.class;
		// 생성자를 얻고, 인스턴스를 만듬
		Object target = clz.getDeclaredConstructor().newInstance();

		// 클래스에 있는 모든 메소드를 가져올 수 있다
		Method[] methods = clz.getDeclaredMethods();		
		for (Method m : methods) {
			if(!m.isAnnotaionsPressent(RequestMappig.class)) {
				continue;
			}
			RequestMapping rm = m.getAnnotation(RequestMapping.class);
			sysout(rm);
			String value = rm.value();
			stsout(value);
			
			mapping.put(value, new CtrlAndMethod(m, target));
			sysout(mapping);
		}
	}
	
	// 호출
	public void execute(String url) throws Exception {
		CtrlAndMethod cam = mapping.get(url);
		if (cam == null) {
			sysout("존재하지 않는 주소 : 404");
			return;
		}
		Method method = cam.getMethod();
		Object object = cam.getTarget();
		method.invoke(target);
	}
	
	private static Executor instance;
	public synchronized static Executor getInstance() throws Exception {
		if (instance == null) {
			instance = new Executor();
		}
		return instance;
	}
}

// Test class
public class Test {
	public static void main(String[] args) {
		try {
			Executor e = Executor.getInstance();
			e.excute("/member/join");
			e.excute("/member/list");
		}
		catch (Exception e){
			e.printStackTrace();
		}	
	}
}



public class CtrlAndMethod {

	private Method method;
	private Object target;
	
	
	
	// 생성자
	
	
	//게터 세터
	
	
	
	
}
